var loginUrl="http://tantora.jp/nologin/login/try",mypageUrl="http://tantora.jp/my",battleListUrl="http://tantora.jp/battle/list",battleOtherUrl="http://tantora.jp/battle?other_id",playerUrl="http://tantora.jp/player?other_id=",runawayUrl="http://tantora.jp/battle/runaway-exec",kachikomiUrl="http://tantora.jp/kachikomi",kachikomiEntryListUrl="http://tantora.jp/kachikomi/entry-list",kachikomiReqUrl="http://tantora.jp/kachikomi/rescue-request",kachikomiBattleUrl="http://tantora.jp/kachikomi/battle?eid=",kachikomiRescueUrl="http://tantora.jp/kachikomi/rescue-entry?eid=",kaUseItemUrl="http://tantora.jp/kachikomi/use-item",kachikomiImgUrl="http://img.tantora.jp/sp_st/img/kachikomi/",kachikomiChatUrl="http://img.tantora.jp/sp_st/img/kachikomi/chat",taUseItemUrl="http://tantora.jp/battle/use-item",useItemUrl="http://tantora.jp/item/use-item-exec",howtoUrl="http://tantora.jp/howto",friendOutUrl="http://tantora.jp/friend/breach-confirm?other_id",boardUrl="http://tantora.jp/board",storyUrl="http://img.tantora.jp/sp_st/img/kachikomi/chat",policeCapSendUrl="http://tantora.jp/battle/confirm-handcheck?player_input=",battle_check="愛車詳細",battle_list="タイマン相手を選べ!!",battle_continue="タイマンが終了していません",healed="⇒回復アイテム一覧",black_list="ブラックリスト一覧",regulation="回線が混み合っています",police="※画像に表示されている数字を半角にて入力してください",kachikomiHelpLimit=["救援回数上限","応援参戦中のバトル"],kachikomiReBattle="バトル再開!!",gotoOuen="応援に向かう",ouenBattle="応援参戦中のバトル",checkstamina="体力が足りない!!",nyuuin="入院中HP",haventItem=["回復アイテムを持っていなかった","回復アイテムを所持していません"];maintenance="システム調整中",runaway="タイマンから逃げました...",no_team="族に所属していない",accessBlock="アクセス制限",checkstatus="参戦中リスト";var mode="defo",k_js=!1,heel=!1,eid_url=void 0,yousei=!0,yousei_wait=0,team_status=!0,botstatus=!1,b_cnt=0,exp_limitter,v=0,stimer,etimer,eid,pid,q,h,t,y="",n,l=void 0,b_cnt_set,mainui='<div id="turu"><div class="title-covor" style="margin: 5px 0;"><div class="title-inner" style="background-color: #414141;">単車の鶴 Ver1.0</div></div><div class="title-inner" style="background-color: #eb6100;">設定</div><div style="background-color: #222222; padding: 2px 0;" class="aligncenter"><form id="autoItem" name="sendItem" style="margin:0.6em 0;"><div class="setContainer"><div class="set"><lable style="font-weight:bold;color:#f8f8ff;" class="stitle" for="itemspirit" >気合回復: <br></lable><select id="itemspirit"><option value="378" selected="selected">タバコ</option><option value="1721">レッドヘブン</option>  </select></div><div class="set">  <lable style="font-weight:bold;color:#f8f8ff;" class="stitle" for="itemstamina" >体力回復: <br></lable>  <select id="itemstamina">    <option value="184" selected="selected">しやがれ</option>    <option value="1719">牛乳</option>  </select></div><div class="set">  <lable style="font-weight:bold;color:#f8f8ff;" class="stitle" for="itemhp" >HP回復: <br></lable>  <select id="itemhp">   <option value="68">焼きそば</option>    <option value="255" selected="selected">牛丼</option>    <option value="800">つけ麺</option>    <option value="1722">ピッツァ</option>    <option value="2895">焼き飯</option>  </select></div></div><hr class="light" style="margin: 0.3em 0;"><div id="enemy_rank" class="set" >  <label class="stitle" >Lv: <br></label><input type="radio" name="option1" id="option1_1" value="correct=minus"><label for="option1_1">弱</label><input type="radio" name="option1" id="option1_2" checked="" value=""><label for="option1_2">同</label><input type="radio" name="option1" id="option1_3" value="correct=plus"><label for="option1_3">強</label></div><hr class="light" style="margin: 0.3em 0;"><div id="enemy_rank" class="set" >  <label class="stitle" >防御特化野郎<br></label><input type="radio" name="option6" id="option6_1"><label for="option6_1">無視</label><input type="radio" name="option6" id="option6_2" checked><label for="option6_2">倒す</label></div><hr class="light" style="margin: 0.3em 0;"><div id="mode" class="set" ><label class="stitle" >バトルモード:<br> </label><input type="radio" name="option2" id="option2_1" checked value="default"><label for="option2_1">両方</label><input type="radio" name="option2" id="option2_2" value="ouen"><label for="option2_2">カチコミのみ</label><input type="radio" name="option2" id="option2_3" value="taiman"><label for="option2_3">タイマンのみ</label></div><hr class="light" style="margin: 0.3em 0;"><div id="yousei" class="set" ><label class="stitle" >カチコミ要請:<br> </label><input type="radio" name="option3" id="option3_1" checked><label for="option3_1">送る</label><input type="radio" name="option3" id="option3_2"><label for="option3_2">送らない</label></div><hr class="light" style="margin: 0.3em 0;"><div id="kyuuenji" class="set" ><label class="stitle" >カチコミ救援時: <br></label><input type="radio" name="option4" id="option4_1"><label for="option4_1">参加のみ</label><input type="radio" name="option4" id="option4_2"><label for="option4_2">寸止め</label><input type="radio" name="option4" id="option4_3" checked><label for="option4_3">鬼叩き</label></div><hr class="light" style="margin: 0.3em 0;"><div id="explimitter" class="set" ><label class="stitle" >EXPリミッター： <br></label><input type="radio" name="option7" id="option7_1"value="90"><label for="option7_1">90%</label><input type="radio" name="option7" id="option7_2" value="99"><label for="option7_2">99%</label><input type="radio" name="option7" id="option7_3" value="0" checked><label for="option7_3">無効</label></div><hr class="light" style="margin: 0.3em 0;"><div class="set"><label class="stitle">自動一時停止: <br></label><output id="setTimer">1時間後</output><input type="range" name="option5" id="option5" min="0" max="6" step="1" value="1"></div><hr class="light" style="margin: 0.3em 0;"><div id="autostart" class="aligncenter"><a class="common-button">スタート</a></div></div><hr class="gold" style="margin: 0.3em 0;"></form><style>.setContainer{  padding-left:10px;  padding-right:10px; display: flex;  display: -webkit-flex; /* Safari */ -webkit-justify-content: space-around; /* Safari */ flex-direction: row-reverse;  justify-content: space-between;}select {  margin: 0px auto 10px auto;  border-radius: 10px;  position: relative;  padding: 0px;  background-color: #333;width:6em;color:red;}.set{  color:#a9a9a9;  padding-top:10px; padding-bottom:10px;}form lable .set {  display:block !important; float:left !important;}label.stitle { display:block;  color:#f8f8ff;  font-weight:bold; margin-bottom:5px;  }label{ font-size: 14px;  margin-right:0.3em; }input[type="range"]{ margin:auto;  display:block;  width:90%;  height:100%;}input[type="radio"]:checked + label {  color:deepskyblue;}output {   color:deepskyblue;}#autostart .common-button{ width:10em; margin-bottom: -10px;}</style></div>';$(function(){function A(c,f,b){var k=Date.now(),a=v+200-k;0>a&&(a=4),v=a+k,setTimeout(function(){new $.ajax({url:f,type:c,timeout:10000,data:b,dataType:"html"}).done(function(i){E($.parseHTML(i))}).fail(function(i,m){"timeout"==m&&alert("タイムアウト"),G(i)})},a)}function E(f){var c,i=Math.round((Date.now()-stimer)/60000);if(i>etimer&&0!==etimer){var b=30+Math.floor(120*Math.random());B("制限時間に到達<br>"+b.toString()+"分後に再スタートします","待機中"),$.wait(60*b*1000).done(function(){A("GET",kachikomiUrl,null)}),stimer=Date.now()}else{if($(f)[0]){if(t=$(f).text(),h=$("<div />").append(f).find("#all_display_wrapper"),-1!=t.indexOf(black_list)){return pid=$(h).find(".gkbutton").attr("href").split("=")[1],g(pid),!1}$(h).find("#remaining_time")[0]?($(h).find("#menu-list").remove(),$(h).find(".footer").remove(),$(h).find('[class="acordion close"]').remove(),$(document.head).find("link")[2].href="http://img.tantora.jp/sp_st/css/battle/common.min.css",$("#all_display_wrapper").replaceWith($(h))):-1!=$(h).html().indexOf("討伐履歴リスト")||$(h).find("#battleReliefNum")[0]?($.ajaxSetup({cache:!0}),$.getScript("http://img.tantora.jp/sp_st/js/kachikomi/common.js"),$(h).find("#menu-list").remove(),$(h).find(".footer").remove(),$(document.head).find("link")[2].href="http://img.tantora.jp/sp_st/css/kachikomi/common.css",$("#all_display_wrapper").replaceWith($(h))):-1!=t.indexOf(police)&&$("#all_display_wrapper").replaceWith($(h)),c=-1!=$(h).html().indexOf(kachikomiChatUrl)?"story":-1!=t.indexOf(accessBlock)?"access-block":-1!=t.indexOf(no_team)?"checkteam":-1!=t.indexOf(haventItem[0])||-1!=t.indexOf(haventItem[1])?"noheel":-1!=t.indexOf(battle_continue)?"battle-continue":-1!=t.indexOf(runaway)?"runaway":-1!=t.indexOf(maintenance)?"maintenance":-1!=t.indexOf(battle_check)?"battle-check":$(h).find("#remaining_time")[0]?"battle":-1!=t.indexOf(battle_list)?"battle-list":-1!=t.indexOf(healed)?"healed":-1!=t.indexOf(regulation)?"regulation":-1!=t.indexOf(police)?"police":-1!=t.indexOf(kachikomiHelpLimit[0])||-1!=t.indexOf(kachikomiHelpLimit[1])?"kachikomiHelpLimit":-1!=t.indexOf(checkstatus)?"checkstatus":$(h).find("#EnemyStatus")[0]?"kachikomi-battle":"error",w(c),g(c)}else{g("error: empty content")}}}function w(I){switch(I){case"error":g("error");break;case"access-block":B("現在アクセス規制中のため、カチコミに参加できません","アクセス規制"),g("erro: access block");break;case"story":A("GET",kachikomiUrl,null);break;case"runaway":A("GET",kachikomiUrl,null);break;case"maintenance":B("回復待ち","メンテナンス待機中"),$.wait(180000).done(function(){A("GET",kachikomiUrl,null)});break;case"battle-continue":g("continue");break;case"checkteam":team_status=!1,A("GET",kachikomiUrl,null);break;case"battle":if(F(),$(h).find("#win_or_lose")[0]){b_cnt=0,A("GET",kachikomiUrl,null);break}b_cnt++;var f=$(".exp .now").attr("data-exp"),L=$(".exp .max").text();if(!isNaN(f&&L)){f=parseInt(f,10),L=parseInt(L,10);var u=Math.floor(f/L*100);if(u>=exp_limitter&&0!==exp_limitter){B("到達しました","EXPリミッター");break}}if(b_cnt>b_cnt_set){b_cnt=0,A("GET",$("#battle_data_for_js").attr("data-runaway_url"),null)}else{if(-1!=t.indexOf(checkstamina)){A("POST",taUseItemUrl,"item_id="+stamina_item_id+"&button=%E4%BD%BF%E3%81%86")}else{if($(h).find("#Skill_1 a")[0]&&$(h).find("#Skill_2 a")[0]){if(nowhp=$(h).find("#PlayerStatus .hp .now").text(),maxhp=$(h).find("#PlayerStatus .hp .max").text(),nowhp<=0.4*maxhp){var i=Math.floor((maxhp-nowhp)/150);i>1?A("GET",taUseItemUrl,"item_id="+hp_item_id+"&num="+i+"&use_multi=1&exec=1"):A("GET",taUseItemUrl,"item_id="+hp_item_id+"&num=1")}else{$(h).find(".basic_dialog.runAlert")[0]||closeRunPopup();var p;$(h).find("#Skill_1").hasClass("main on")?(p=$(h).find("#Skill_1 a").attr("onclick").split("'")[1],A("GET",p,null)):$(h).find("#Skill_2").hasClass("main on")?(p=$(h).find("#Skill_2 a").attr("onclick").split("'")[1],A("GET",p,null)):$(h).find("#Action").hasClass("main on")&&(p=$(h).find("#Action a").attr("onclick").split("'")[1],A("GET",p,null))}}else{$(h).find("#Skill_1 a").hasClass("noset")&&$(h).find("#Skill_2 a").hasClass("noset")||A("POST",taUseItemUrl,"item_id="+spirit_item_id+"&button=%E4%BD%BF%E3%81%86")}}}break;case"battle-list":"ouen"!=mode&&$(h).find("#content_body a").each(function(){var a=$(this).attr("href");if(a){if(-1!=a.indexOf(playerUrl)){return A("GET",a,null),!1}if(-1!=a.indexOf(howtoUrl)){return !1}}});break;case"battle-check":var H;if(-1!=t.indexOf(nyuuin)){A("GET",useItemUrl,"item_id="+hp_item_id+"&num=30&exec=1",null);break}"ouen"!=mode&&($(h).find("a").each(function(){var a=$(this).attr("href");if(a){if(-1!=a.indexOf(battleOtherUrl)){return H=a,!1}if(-1!=a.indexOf(friendOutUrl)){return H=void 0,!1}if(-1!=a.indexOf(howtoUrl)){return !1}}}),"undefined"!=typeof H?A("GET",H,null):A("GET",battleListUrl,enemy_rank));break;case"noheel":B("回復待ち...","回復アイテム無し"),$.wait(180000).done(function(){A("GET",kachikomiUrl,null)});break;case"healed":heel===!1?A("GET",kachikomiUrl,null):A("GET",l,null);break;case"kachikomi-battle":var K=$(".exp .now").text(),J=$(".exp .max").text();if(!isNaN(K&&J)){K=parseInt(K,10),J=parseInt(J,10);var r=Math.floor(K/J*100);if(r>=exp_limitter&&0!==exp_limitter){B("到達しました","EXPリミッター");break}}heel===!1?yousei===!0?-1!=h.html().indexOf(kachikomiReqUrl)&&team_status?(n=Date.now()+60000*yousei_wait,A("GET",kachikomiReqUrl,null)):"undefined"==typeof n?(heel=!0,A("GET",eid_url,null)):A("GET",battleListUrl,enemy_rank):(heel=!0,A("GET",eid_url,null)):heel===!0&&(e_h=$(h).find("#EnemyStatus .hp .now").text(),e_h&&!isNaN(e_h)&&(e_h=parseInt(e_h,10)),!e_h||q===!0&&(0===kyuuen||1===kyuuen&&10000>=e_h)?(q=!1,y=eid,n=void 0,heel=!1,A("GET",kachikomiUrl,null)):-1!=t.indexOf(nyuuin)&&-1==t.indexOf(haventItem[0])?A("GET",kaUseItemUrl,"item_id="+hp_item_id+"&num=30&use_multi=1&eid="+eid+"&exec=1"):$(h).find("#battle_button_1 a")[0]?!$(h).find("#battle_button_2 a")[0]&&$(h).find("#battle_button_2")[0]?A("GET",kaUseItemUrl+"?item_id="+spirit_item_id+"&eid="+eid,null):$(h).find("#battle_button_2 a")[0]?A("GET",$(h).find("#battle_button_2 a").attr("onclick").split("'")[1],null):A("GET",$(h).find("#battle_button_1 a").attr("onclick").split("'")[1],null):A("GET",kaUseItemUrl+"?item_id="+stamina_item_id+"&eid="+eid,null));break;case"checkstatus":-1!=t.indexOf(nyuuin)?A("GET",useItemUrl,"item_id="+hp_item_id+"&num=30&exec=1",null):battleListUrl!=$(h).find("#header_menu a")[1].href?A("POST",useItemUrl,"item_id="+stamina_item_id+"&button=%E4%BD%BF%E3%81%86"):"taiman"!=mode&&60>yousei_wait&&-1!=t.indexOf(kachikomiReBattle)&&("undefined"==typeof n||Date.now()>=n)?((new Date).getTime()>=n&&(heel=!0),eid_url=$(h).find(".imgButtonS a")[0].href,eid=eid_url.replace(kachikomiBattleUrl,""),A("GET",eid_url,null)):"taiman"!=mode&&-1!=t.indexOf(gotoOuen)?$(h).find(".imgButtonS a").each(function(a){return e=$(h).find(".imgButtonS a")[a].href.replace(kachikomiRescueUrl,""),-1==y.indexOf(e)?(heel=q=!0,eid=e,eid_url=kachikomiBattleUrl+eid,A("GET",kachikomiRescueUrl+e,null),!1):(a==$(h).find(".imgButtonS a")[0]-1&&"ouen"!=mode?A("GET",battleListUrl,enemy_rank):A("GET",kachikomiEntryListUrl,null),!1)}):"ouen"!=mode?A("GET",battleListUrl,enemy_rank):A("GET",kachikomiEntryListUrl,null);break;case"kachikomiHelpLimit":-1!=t.indexOf(ouenBattle)?$(h).find(".hp").each(function(c){d=Date.now();var b=$(h).find(".hp").find("script");return b[0]&&(e=1000*b[b.size()-1].innerText.split(",")[1]),0==$(this).find("li").width()||d>e?(_eid_url=$(h).find(".imgButtonS a")[c].href,eid=_eid_url.replace(kachikomiBattleUrl,""),heel=!0,A("GET",_eid_url,null),!1):(c==$(h).find(".hp").size()-1&&(q=!1,"ouen"!=mode?A("GET",battleListUrl,enemy_rank):A("GET",kachikomiEntryListUrl,null)),!1)}):A("GET",kachikomiEntryListUrl,null);break;case"police":j();break;case"regulation":B("回線が混み合っています。1分後に再開します","サーバーエラー"),$.wait(60000).done(function(){A("GET",kachikomiUrl,null)});break;default:A("GET",kachikomiUrl,null)}}function g(a){console.log(a)}function G(a){console.log("--Error--",this.type),console.log("this: ",this),console.log("Event: ",a)}function C(a){var b=new XMLHttpRequest;b.open("POST","http://monst.s602.xrea.com/ttr/gif.php"),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send("data="+encodeURIComponent(a)),b.onreadystatechange=function(){4==b.readyState&&(200==b.status?"0"!=b.responseText?x(b.responseText):console.log("unreg"):x(b.responseText))}}function j(){var a=new Image;a.src="http://tantora.jp/battle/get-check-image",a.onload=function(){var c=document.createElement("canvas");c.width=this.width,c.height=this.height;var f=c.getContext("2d");f.drawImage(this,0,0);var b=c.toDataURL("image/jpg");C(b.replace(/^data:image\/(png|jpg|gif);base64,/,""))},a.onerror=function(){console.log("Image not loaded")}}function x(c){event.preventDefault();var f=document.forms[0];f.submit.disabled=!0;var b=f.getElementsByTagName("input")[1].value;"undefined"!=typeof c?A("POST","http://tantora.jp/battle/confirm-handcheck","player_input="+c+"&other_id="+b+"&submit=%E7%A2%BA%E8%AA%8D"):A("POST","http://tantora.jp/battle/confirm-handcheck","player_input=0&other_id="+b+"&submit=%E7%A2%BA%E8%AA%8D")}function F(){var f=parseInt($(h).find("#EnemyAttack .AttackDamage").text(),10)||0,k=$(h).find("#EnemyStatus .now").text();$(h).find("#EnemyStatus .now").text(k-f);var c=parseInt($("#PlayerAttack .AttackDamage").text(),10)||0,b=$(h).find("#PlayerStatus .hp .now").text(),m=$(h).find("#PlayerStatus .stamina .now").text();f>0&&$("#PlayerStatus .stamina .now").text(parseInt(m,10)-1),$(h).find(".HeelPoint")[0]&&(c-=parseInt($(h).find("#PlayerHeelhp .HeelPoint").text(),10))||0,sta=parseInt($(h).find("#PlayerHeelstamina .HeelPoint").text()),!isNaN(sta)&&$(h).find("#PlayerStatus .stamina .now").text(parseInt(m,10)+parseInt(sta,10)),$(h).find("#PlayerStatus .hp .now").text(b-c)}function B(b,c){$(h).find(".basic_dialog.runAlert")[0]||closeRunPopup();var a='<div class="basic_dialog_message" class="centerThis"><p>'+b+"</p></div>";a+='<div class="btnsOKNO"><div class="basic_dialog_OK" class="centerThis btn btn_1_1_on">停止する</div></div>',openAlertPopup(c,a,function(){location.href=mypageUrl})}function z(){var a=$.parseHTML(mainui),b=$(".gold")[0];$(b).replaceWith(a),$("#option5").change(function(){var c=$(this).val();etimer=parseInt(c,10),etimer*=60,"0"==c?$("#setTimer").html("ノンストップ<br><p style='font-size:x-small;color:red'>（注意：長すぎると規制される可能性が高くなります）</p>"):$("#setTimer").text(c+"時間後")}),etimer=parseInt($("#option5").val(),10),etimer*=60,$("#autostart").on("click",function(){botstatus||(botstatus=!0,D(),stimer=Date.now(),A("GET",boardUrl,null),A("GET",kachikomiUrl,null))})}function D(){hp_item_id=$("#itemhp :selected").val(),stamina_item_id=$("#itemstamina :selected").val(),spirit_item_id=$("#itemspirit :selected").val(),enemy_rank=$("#enemy_rank input:checked").val(),mode=$("#mode input:checked").val(),yousei=$("#option3_1").is(":checked"),$("#explimitter input").each(function(){$(this).is(":checked")&&(exp_limitter=$(this).val())}),exp_limitter=parseInt(exp_limitter,10),$("#kyuuenji input").each(function(a){$(this).is(":checked")&&(kyuuen=a)}),b_cnt_set=$("#option6_1").is(":checked")?60:200}$.wait=function(a){var b=new $.Deferred;return setTimeout(function(){b.resolve(a)},a),b.promise()},z()});